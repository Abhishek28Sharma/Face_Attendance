<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attendance Records</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#131314] text-gray-100 min-h-screen p-4 md:p-8">
  <div class="max-w-6xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
      <h4 class="text-2xl font-bold text-white tracking-tight">Attendance Records</h4>
      <div class="flex gap-3">
        <button onclick="submitFilterForm(true)"
          class="px-4 py-2 border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-white rounded-lg transition text-sm font-medium">
          Download Filtered CSV
        </button>
        <a class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition text-sm font-medium"
          href="/">Back</a>
      </div>
    </div>

    <form id="filterForm" action="/attendance_record" method="GET"
      class="bg-[#1c1c1e] p-6 rounded-xl border border-gray-800 mb-8">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <div>
          <label class="block text-[10px] uppercase text-gray-500 font-bold mb-1">Semester</label>
          <input type="text" name="semester" placeholder="e.g. 4th"
            class="w-full bg-[#2c2c2e] border border-gray-700 rounded-md px-3 py-1.5 text-sm focus:ring-1 focus:ring-blue-500 outline-none">
        </div>
        <div>
          <label class="block text-[10px] uppercase text-gray-500 font-bold mb-1">Branch</label>
          <input type="text" name="branch" placeholder="e.g. BCA"
            class="w-full bg-[#2c2c2e] border border-gray-700 rounded-md px-3 py-1.5 text-sm focus:ring-1 focus:ring-blue-500 outline-none">
        </div>
        <div>
          <label class="block text-[10px] uppercase text-gray-500 font-bold mb-1">Month</label>
          <select name="month"
            class="w-full bg-[#2c2c2e] border border-gray-700 rounded-md px-3 py-1.5 text-sm outline-none">
            <option value="">All Months</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
          </select>
        </div>
        <div>
          <label class="block text-[10px] uppercase text-gray-500 font-bold mb-1">Day</label>
          <input type="number" name="day" placeholder="DD" min="1" max="31"
            class="w-full bg-[#2c2c2e] border border-gray-700 rounded-md px-3 py-1.5 text-sm outline-none">
        </div>
        <div class="flex items-end">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-1.5 rounded-md text-sm font-bold transition">Apply
            Filters</button>
        </div>
      </div>
      <input type="hidden" name="download" id="downloadTrigger" value="false">
    </form>

    <div class="bg-[#1c1c1e] rounded-xl shadow-2xl border border-gray-800 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-[#2c2c2e] text-gray-400 uppercase text-[11px] tracking-widest font-bold">
              <th class="px-6 py-4">Roll No</th>
              <th class="px-6 py-4">Reg No</th>
              <th class="px-6 py-4">Name</th>
              <th class="px-6 py-4">Date/Time</th>
              <th class="px-6 py-4">Semester</th>
              <th class="px-6 py-4">Branch</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-800">
            {% for r in records %}
            <tr class="hover:bg-[#252527] transition duration-150">
              <td class="px-6 py-4 text-sm text-gray-300 font-bold">{{ r[1] }}</td>
              <td class="px-6 py-4 text-sm text-gray-400 font-mono">{{ r[2] }}</td>
              <td class="px-6 py-4 text-sm font-medium text-white">{{ r[3] }}</td>
              <td class="px-6 py-4 text-sm text-blue-400">{{ r[4] }}/{{ r[6] }}/{{ r[7] }} - {{ r[5] }}</td>
              <td class="px-6 py-4 text-sm text-gray-400">{{ r[8] }}</td>
              <td class="px-6 py-4 text-sm text-gray-400">{{ r[9] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function submitFilterForm(shouldDownload) {
      document.getElementById('downloadTrigger').value = shouldDownload ? 'true' : 'false';
      document.getElementById('filterForm').submit();
      // Reset trigger so next normal click isn't a download
      setTimeout(() => { document.getElementById('downloadTrigger').value = 'false'; }, 500);
    }
  </script>
</body>

</html>