<!doctype html>
<html lang="en">

<head>
  <title>Subject-wise Attendance</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#131314] text-gray-100 p-8">
  <div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-8">
      <div>
        <div class="flex items-center gap-4 mb-2">
          <a href="/" class="text-xs bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded-md transition">‚Üê Dashboard</a>
          <h2 class="text-2xl font-bold">Attendance Report</h2>
        </div>
        <p class="text-blue-400 font-mono">Date: {{ current_date }}</p>
      </div>

      <form class="flex gap-2 items-end">
        <div>
          <label class="block text-[10px] uppercase text-gray-500 mb-1">Select Date</label>
          <input type="date" id="datePicker" class="bg-[#1c1c1e] border border-gray-700 p-2 rounded text-sm text-white">
        </div>
        <button type="button" onclick="filterDate()"
          class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm font-bold transition">View</button>
      </form>
    </div>

    <div class="bg-[#1c1c1e] rounded-2xl border border-gray-800 overflow-hidden shadow-2xl">
      <table class="w-full text-left">
        <thead class="bg-[#2c2c2e] text-gray-400 text-xs uppercase tracking-widest">
          <tr>
            <th class="p-4 border-r border-gray-700">Roll No</th>
            <th class="p-4 border-r border-gray-700">Student Name</th>
            {% for sub in subjects %}
            <th class="p-4 text-center border-r border-gray-800/30">{{ sub }}</th>
            {% endfor %}
            <th class="p-4 text-center bg-blue-900/20 text-blue-400">Total P</th>
            <th class="p-4 text-center bg-blue-900/20 text-blue-400 border-l border-gray-700">Attendance %</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-800">
          {% for student in report_data %}
          <tr class="hover:bg-white/5 transition">
            <td class="p-4 text-gray-400 font-mono border-r border-gray-700">{{ student.roll }}</td>
            <td class="p-4 font-bold border-r border-gray-700 text-white">{{ student.name }}</td>

            {% for sub in subjects %}
            <td class="p-4 text-center border-r border-gray-800/30">
              <span
                class="uppercase {{ 'text-green-500 font-bold' if student.attendance[sub] == 'p' else 'text-red-500 opacity-40' }}">
                {{ student.attendance[sub] }}
              </span>
            </td>
            {% endfor %}

            <td class="p-4 text-center font-bold text-white bg-blue-900/10">
              {{ student.present_count }} / {{ subjects|length }}
            </td>
            <td class="p-4 text-center font-bold bg-blue-900/10 border-l border-gray-700">
              <span
                class="{{ 'text-green-400' if student.percentage >= 75 else 'text-yellow-500' if student.percentage >= 50 else 'text-red-500' }}">
                {{ student.percentage }}%
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function filterDate() {
      const dateVal = document.getElementById('datePicker').value;
      if (!dateVal) return;
      const d = new Date(dateVal);
      const day = d.getDate().toString().padStart(2, '0');
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      window.location.href = `/view_pivot_history?date=${day}&month=${months[d.getMonth()]}&year=${d.getFullYear()}`;
    }
  </script>
</body>

</html>